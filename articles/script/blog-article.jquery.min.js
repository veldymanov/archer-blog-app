var mobileMenuTouchSlider={log:function(msg){},createSlidePanel:function(panel,width){this.width=width;try{document.createEvent('TouchEvent');this.makeTouchable(panel);}catch(e){}finally{}},makeTouchable:function(panel){$(panel).each(function(){this.addEventListener('touchstart',function(e){mobileMenuTouchSlider.touchStart($(this),e);},false);this.addEventListener('touchmove',function(e){mobileMenuTouchSlider.touchMove($(this),e);},false);this.addEventListener('touchend',function(e){mobileMenuTouchSlider.touchEnd($(this),e);},false);});},touchStart:function(elem,e){this.startX=e.targetTouches[0].clientX;this.startY=e.targetTouches[0].clientY;this.slider=0;this.startRight=this.getRight(elem);},touchMove:function(elem,e){var deltaX=e.targetTouches[0].clientX-this.startX;var deltaY=e.targetTouches[0].clientY-this.startY;if(((this.slider===0))&&(Math.abs(deltaY)>Math.abs(deltaX))){this.slider=-1;}else if(this.slider!=-1){e.preventDefault();this.slider=1;var right=this.startRight-deltaX;;if(right>0){right=0;}elem.css({right:right+'px'});}},touchEnd:function(elem,e){this.doSlide(elem,e);},getRight:function(elem){return parseInt(elem.css('right'),10);},doSlide:function(elem,e){var right=this.getRight(elem);if((Math.abs(right))<((this.width/2))){elem.animate({right:0+'px'},300);}else{elem.animate({right:-this.width+'px'},300,function(){$(this).hide();});$('#js-body').css('overflow','auto');}this.startX=null;this.startY=null;}};var otherAtclsTouchSlider={log:function(msg){},createSlidePanel:function(gridid,cellWidth,cellHeight,padding){var padding=padding||0;var x=padding;$(gridid).each(function(){$(this).parent().css({margin:'0 auto',overflow:'hidden'});$(this).css({'height':cellHeight+'px','left':'0px','list-style-type':"none",'margin':'0','padding':'0','position':'relative'});$(this).children('.js-touch-slider-item').each(function(){$(this).css({"height":'100%',"left":x+'px',"position":'absolute',"top":padding+'px',"width":cellWidth+'px'});x+=cellWidth+padding;});otherAtclsTouchSlider.width=x;otherAtclsTouchSlider.colWidth=cellWidth+padding;try{document.createEvent('TouchEvent');otherAtclsTouchSlider.makeTouchable(gridid);}catch(e){}finally{otherAtclsTouchSlider.touchAreaSize(gridid);$(window).resize(function(){otherAtclsTouchSlider.touchAreaSize(gridid)});$('.js-prev').on('click',function(){otherAtclsTouchSlider.prevClick(gridid)});$('.js-next').on('click',function(){otherAtclsTouchSlider.nextClick(gridid)});}});},prevClick:function(gridid){var left=this.getLeft($(gridid));var maxDelta=this.width-parseInt($(gridid).parent().width(),10);if((left%this.colWidth)===0){left-=this.colWidth;if(Math.abs(left)<=Math.abs(maxDelta)){this.doSlide($(gridid),left,'0.5s');}}},nextClick:function(gridid){var left=this.getLeft($(gridid));if((left%this.colWidth)===0){left+=this.colWidth;if(left<=0){this.doSlide($(gridid),left,'0.5s');}}},touchAreaSize:function(gridid){$(gridid).parent().each(function(){var touchAreaWidth100=parseInt($(this).css({width:'100%'}).css('width'),10);var elNumber=parseInt(touchAreaWidth100/otherAtclsTouchSlider.colWidth,10);var touchAreaWidth=elNumber*otherAtclsTouchSlider.colWidth;$(this).css({width:touchAreaWidth});});},makeTouchable:function(gridid){$(gridid).each(function(){this.addEventListener("touchstart",function(e){otherAtclsTouchSlider.touchStart($(this),e);},false);this.addEventListener("touchmove",function(e){otherAtclsTouchSlider.touchMove($(this),e);},false);this.addEventListener("touchend",function(e){otherAtclsTouchSlider.touchEnd($(this),e);},false);});},touchStart:function(elem,e){elem.css({'-ms-transition':'left 0s','-moz-transition':'left 0s','-o-transition':'left 0s','transition':'left 0s'});this.startX=e.targetTouches[0].clientX;this.startY=e.targetTouches[0].clientY;this.slider=0;this.startLeft=this.getLeft(elem);this.touchStartTime=new Date().getTime();},touchMove:function(elem,e){var deltaX=e.targetTouches[0].clientX-this.startX;var deltaY=e.targetTouches[0].clientY-this.startY;if(((this.slider===0))&&(Math.abs(deltaY)>Math.abs(deltaX))){this.slider=-1;}else if(this.slider!=-1){e.preventDefault();this.slider=1;var left=deltaX+this.startLeft;elem.css({left:left+'px'});if(this.startX>e.targetTouches[0].clientX){this.slidingLeft=true;}else{this.slidingLeft=false;}}},touchEnd:function(elem,e){if(this.getLeft(elem)>0){this.doSlide(elem,0,'1s');this.startX=null;}else if(Math.abs(this.getLeft(elem))>(this.width-elem.parent().width())){this.doSlide(elem,'-'+(this.width-elem.parent().width()),'1s');this.startX=null;}else{this.slideMomentum(elem,e);}},getLeft:function(elem){return parseInt(elem.css('left'),10);},doSlide:function(elem,x,duration){elem.css({left:x+'px','-ms-transition':'left '+duration,'-moz-transition':'left '+duration,'-o-transition':'left '+duration,'-webkit-transition':'left '+duration,'transition':'left '+duration});if(x===0){$('.js-next').removeClass('is-active');$('.js-prev').addClass('is-active');}else if(Math.abs(x)===this.width-parseInt(elem.parent().width(),10)){$('.js-prev').removeClass('is-active');$('.js-next').addClass('is-active');}else{$('.js-prev').addClass('is-active');$('.js-next').addClass('is-active');}},slideMomentum:function(elem,e){var slideAdjust=(new Date().getTime()-this.touchStartTime)*65;var left=this.getLeft(elem);var changeX=12000*(Math.abs(this.startLeft)-Math.abs(left));slideAdjust=Math.round(changeX/slideAdjust);var newLeft=left+slideAdjust;var t=newLeft%this.colWidth;if((Math.abs(t))>((this.colWidth/2))){newLeft-=(this.colWidth-Math.abs(t));}else{newLeft-=t;}if(this.slidingLeft){var maxLeft=parseInt('-'+(this.width-elem.parent().width()),10);this.doSlide(elem,Math.max(maxLeft,newLeft),'0.5s');}else{this.doSlide(elem,Math.min(0,newLeft),'0.5s');}this.startX=null;}};var articlesLoader={loadArticles:function(nmbrs){$.ajax('../articles.json',{contextType:'application/json',dataType:'json',timeout:13000,success:function(response){articlesLoader.response=response;articlesLoader.createInterestingArticles(nmbrs);articlesLoader.createOtherArticles();articlesLoader.createRelatedPosts();},error:function(request,errorType,errorMessage){alert('Error: '+errorType+' with message: '+errorMessage);},complete:function(){otherAtclsTouchSlider.createSlidePanel('#js-touch-slider',240,125);var x=-articlesLoader.currentArticleIndex*240;otherAtclsTouchSlider.doSlide($('#js-touch-slider'),x,0);}});},createInterestingArticles:function(nmbrs){var resp=articlesLoader.response;var l;if(nmbrs<resp["articles"].length){l=nmbrs;}else{l=resp["articles"].length;}for(var i=0;i<l;i++){var atclsItem=$("<li class='intr-atcls-list-item'></li>");var a=$("<a href="+resp["articles"][i].atclRef+">"+resp["articles"][i].head+"</a>");atclsItem.append(a);$('#js-intr-atcls-list').append(atclsItem);}},createOtherArticles:function(){var resp=articlesLoader.response;var l=resp["articles"].length;var pathArray=window.location.pathname.split('/');for(var i=0;i<l;i++){if(resp["articles"][i].atclRef===pathArray[pathArray.length-1]){this.currentArticleIndex=i;break}}for(var i=0;i<l;i++){var touchSliderItem=$("<li class='touch-slider-item js-touch-slider-item'></li>");var h3=$("<h3></h3>");var a=$("<a href="+resp["articles"][i].atclRef+">"+resp["articles"][i].head+"</a>");if(i===this.currentArticleIndex){a.css("color","#CCC");}$("#js-touch-slider").append(touchSliderItem.append(h3.append(a)));}},createRelatedPosts:function(){var resp=articlesLoader.response;var l=resp["articles"].length;var currentArticle=resp["articles"][this.currentArticleIndex];var relAtclsID=currentArticle.relatedAtclsId;var relAtclsLength=currentArticle.relatedAtclsId.length;for(var i=0;i<relAtclsLength;i++){for(var j=0;j<l;j++){if(resp["articles"][j].id===relAtclsID[i]){var relatedAtclsItem=$("<li class='related-atcls-item'></li>");var relatedAtcl=$("<article class='related-atcl'></article>");var relatedAtclDate=$("<p class='related-atcl-date'>"+resp["articles"][j].date+"</p>");var relatedAtclFig=$("<figure class='related-atcl-fig'>"+"<img src='images/"+resp["articles"][j].imgName+".mobile.jpg"+"'alt='Article picture'"+"srcset = 'images/"+resp["articles"][j].imgName+".mobile.jpg 640w,"+"images/"+resp["articles"][j].imgName+".desktop.jpg 1200w' /></figure>");var h4=$("<h4></h4>");var a=$("<a href="+resp["articles"][j].atclRef+">"+resp["articles"][j].head+"</a>");relatedAtcl.append(relatedAtclDate).append(relatedAtclFig).append(h4.append(a));relatedAtclsItem.append(relatedAtcl);$("#related-atcls").append(relatedAtclsItem);break}}}}};var commentsObj={jsonFileName:function(){var pathArray=window.location.pathname.split('/');var fileArray=pathArray[pathArray.length-1].split('.');var cmntsJsonFile=fileArray[0]+"-comments.json";return cmntsJsonFile;},loadComments:function(){$.ajax(this.jsonFileName(),{contextType:'application/json',dataType:'json',timeout:3000,success:function(resp){var l=resp.length;var cmntsItem;for(var i=0;i<l;i++){cmntsItem=$("<li class='cmnts-item'>"+"<h5>"+resp[i].name+"</h5>"+"<div>"+"<p>"+resp[i].cmnt+"</p>"+"<span class='clearfix'><a href='javascript:void(0);'>Reply</a></span>"+"</div>");$("#js-cmntsList").append(cmntsItem);}},error:function(request,errorType,errorMessage){alert('Error: '+errorType+' with message: '+errorMessage);},complete:function(){}});},addNewComment:function(resp){this.removeComments();$.ajax(this.jsonFileName(),{contextType:'application/json',dataType:'json',timeout:3000,success:function(resp){var l=resp.length;var cmntsItem;for(var i=0;i<l;i++){cmntsItem=$("<li class='cmnts-item'>"+"<h5>"+resp[i].name+"</h5>"+"<div>"+"<p>"+resp[i].cmnt+"</p>"+"<span class='clearfix'><a href='javascript:void(0);'>Reply</a></span>"+"</div>");$("#js-cmntsList").append(cmntsItem);}},error:function(request,errorType,errorMessage){alert('Error: '+errorType+' with message: '+errorMessage);},complete:function(){var formElements=$("#js-cmnts-form").serializeArray();var cmntsItem=$("<li class='cmnts-item'>"+"<h5>"+formElements[0].value+"</h5>"+"<div>"+"<p>"+formElements[2].value+"</p>"+"<span class='clearfix'><a href='javascript:void(0);'>Reply</a></span>"+"</div>");$("#js-cmntsList").append(cmntsItem);document.forms["cmnts-form"].reset();}});},removeComments:function(){$("#js-cmntsList").empty();}};jQuery(document).ready(function(){function menuSlideIn(event){event.preventDefault();$('.js-head-nav').show().animate({right:"0px"},700);$('#js-body').css('overflow','hidden');}function menuSlideOut(event){var winSize=window.innerWidth;var displ=$('.js-head-nav').css("display");var right=$('.js-head-nav').css("right");var mthMenuIcon=$(event.target).is('.js-menu-icon');var mthMenuIconEls=$('.js-menu-icon').has(event.target);var mthHdNav=$(event.target).is('.js-head-nav');var mthHdNavEls=$('.js-head-nav').has(event.target);if(winSize>640||right==="-240px"||mthMenuIcon||(mthMenuIconEls.length>0)||mthHdNav||(mthHdNavEls.length>0)){return true;}else if(displ==="block"){event.preventDefault();$('.js-head-nav').animate({right:"-240px"},700,function(){$(this).hide();});$('#js-body').css('overflow','auto');}}$(document).on('click touchstart',menuSlideOut);$('.js-menu-icon').on('click',menuSlideIn);mobileMenuTouchSlider.createSlidePanel('.js-head-nav',240);articlesLoader.loadArticles(5);$("#js-btn-add-cmnt").on('click',function(){if($(".cmnts-item").length===0){commentsObj.loadComments();}$('#js-cmnts-form').show();$(this).hide();});$("#js-cmnts-form").submit(function(e){commentsObj.addNewComment();$('#js-cmnts-form').hide();$('#js-btn-add-cmnt').show();e.preventDefault();});});